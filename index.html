<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Car Showcase VR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>

    AFRAME.registerComponent('rotate-y', {
      schema: { speed: { type: 'number', default: 0.3 } },
      tick: function (time, delta) {
        this.el.object3D.rotation.y += THREE.MathUtils.degToRad(this.data.speed) * (delta / 1000) * 60;
      }
    });

    AFRAME.registerComponent('gaze-body', {
      schema: { duration: { type: 'number', default: 350 } },
      init: function () {
        this._s = 0; this._t = 0;
        this.el.object3D.scale.set(0, 0, 0);
        this.el.addEventListener('mouseenter', () => { this._t = 1; });
        this.el.addEventListener('mouseleave', () => { this._t = 0; });
      },
      tick: function (time, delta) {
        if (Math.abs(this._s - this._t) < 0.005) {
          this._s = this._t;
          this.el.object3D.scale.setScalar(this._s);
          return;
        }
        this._s += (this._t - this._s) * Math.min((delta / this.data.duration) * 5, 1);
        this.el.object3D.scale.setScalar(this._s);
      }
    });

    </script>
  </head>

  <body>
    <a-scene
      background="color: #0d0d0d"
      vr-mode-ui="enabled: true"
      renderer="antialias: true; colorManagement: true"
    >

      <a-assets>
        <a-asset-item id="auto" src="macchina_test.glb"></a-asset-item>
      </a-assets>

      <!-- ═══ LUCI ════════════════════════════════════════════════════════════ -->
      <a-light type="ambient" color="#1a1a2e" intensity="0.7"></a-light>
      <a-light type="directional" position="2 4 1" color="#ffffff" intensity="0.4"></a-light>
      <a-light type="spot" position="0 6 -5" color="#ffffff" intensity="3.5" angle="28" penumbra="0.5"></a-light>
      <a-light type="point" position="-5 2 -5" color="#4466ff" intensity="1.5" distance="9"></a-light>
      <a-light type="point" position=" 5 2 -5" color="#ff6600" intensity="1.0" distance="9"></a-light>
      <a-light type="point" position=" 0 0.3 -3" color="#ffffff" intensity="0.5" distance="4"></a-light>
      <a-light type="point" position=" 0 -0.4 -5" color="#223366" intensity="1" distance="5"></a-light>

      <!-- ═══ GARAGE ═══════════════════════════════════════════════════════════ -->

      <!-- Pavimento -->
      <a-plane position="0 -0.51 -5" rotation="-90 0 0" width="22" height="22"
        color="#1a1a1a" material="metalness:0.3; roughness:0.8"></a-plane>
      <!-- Linee gialle pavimento -->
      <a-box position=" 2 -0.505 -5" width="0.05" height="0.001" depth="22" color="#ffcc00" material="emissive:#ffcc00; emissiveIntensity:0.4"></a-box>
      <a-box position="-2 -0.505 -5" width="0.05" height="0.001" depth="22" color="#ffcc00" material="emissive:#ffcc00; emissiveIntensity:0.4"></a-box>

      <!-- Pareti laterali -->
      <a-plane position="-11 4 -5" rotation="0  90 0" width="22" height="10" color="#111111" material="roughness:1"></a-plane>
      <a-plane position=" 11 4 -5" rotation="0 -90 0" width="22" height="10" color="#111111" material="roughness:1"></a-plane>

      <!-- Parete FRONTALE (dietro la macchina) con dettagli -->
      <a-plane position="0 4 -14" rotation="0 0 0" width="24" height="10" color="#0f0f0f" material="roughness:1"></a-plane>
      <!-- Logo / marchio centrato sulla parete frontale -->
      <a-box position="0 5.5 -13.95" width="3.5" height="0.06" depth="0.02" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1.2"></a-box>
      <a-text value="CAR SHOWCASE" align="center" color="#4488ff" width="5" position="0 4.8 -13.9"
        material="emissive:#4488ff" wrap-count="16"></a-text>
      <a-box position="0 4.2 -13.95" width="3.5" height="0.03" depth="0.02" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:0.8"></a-box>
      <!-- Pannellature decorative sulla parete frontale -->
      <a-box position="-5 4 -13.95" width="2.5" height="5" depth="0.03" color="#161616" material="roughness:1"></a-box>
      <a-box position=" 5 4 -13.95" width="2.5" height="5" depth="0.03" color="#161616" material="roughness:1"></a-box>
      <a-box position="-9 4 -13.95" width="2" height="5" depth="0.03" color="#141414" material="roughness:1"></a-box>
      <a-box position=" 9 4 -13.95" width="2" height="5" depth="0.03" color="#141414" material="roughness:1"></a-box>
      <!-- Strisce verticali luminose sulla parete frontale -->
      <a-box position="-3.8 4 -13.93" width="0.04" height="7" depth="0.02" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:0.5; opacity:0.6; transparent:true"></a-box>
      <a-box position=" 3.8 4 -13.93" width="0.04" height="7" depth="0.02" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:0.5; opacity:0.6; transparent:true"></a-box>

      <!-- Parete POSTERIORE (dietro la persona) con dettagli -->
      <a-plane position="0 4 4" rotation="0 180 0" width="24" height="10" color="#0f0f0f" material="roughness:1"></a-plane>
      <!-- Griglia tecnica sulla parete posteriore -->
      <a-box position="0 2 3.95"  width="22" height="0.03" depth="0.02" color="#222" material="roughness:1"></a-box>
      <a-box position="0 4 3.95"  width="22" height="0.03" depth="0.02" color="#222" material="roughness:1"></a-box>
      <a-box position="0 6 3.95"  width="22" height="0.03" depth="0.02" color="#222" material="roughness:1"></a-box>
      <a-box position="-6 4 3.95" width="0.03" height="8" depth="0.02" color="#222" material="roughness:1"></a-box>
      <a-box position=" 6 4 3.95" width="0.03" height="8" depth="0.02" color="#222" material="roughness:1"></a-box>
      <a-box position="-3 4 3.95" width="0.03" height="8" depth="0.02" color="#1a1a1a" material="roughness:1"></a-box>
      <a-box position=" 3 4 3.95" width="0.03" height="8" depth="0.02" color="#1a1a1a" material="roughness:1"></a-box>
      <!-- Accent arancio sulla parete posteriore -->
      <a-box position="0 1.2 3.93" width="8" height="0.04" depth="0.02" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:0.6; opacity:0.5; transparent:true"></a-box>

      <!-- Soffitto -->
      <a-plane position="0 9 -5" rotation="90 0 0" width="24" height="22" color="#0d0d0d" material="roughness:1"></a-plane>
      <!-- Strip LED soffitto -->
      <a-box position="-2.5 8.9 -5" width="0.08" height="0.08" depth="18" color="#ffffff" material="emissive:#ffffff; emissiveIntensity:1; opacity:0.95; transparent:true"></a-box>
      <a-box position=" 2.5 8.9 -5" width="0.08" height="0.08" depth="18" color="#ffffff" material="emissive:#ffffff; emissiveIntensity:1; opacity:0.95; transparent:true"></a-box>
      <!-- Strip LED parete bassa -->
      <a-box position="-10.9 0.08 -5" width="0.05" height="0.05" depth="22" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1; opacity:0.6; transparent:true"></a-box>
      <a-box position=" 10.9 0.08 -5" width="0.05" height="0.05" depth="22" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1; opacity:0.6; transparent:true"></a-box>

      <!-- ═══ PIATTAFORMA ROTANTE ══════════════════════════════════════════════ -->
      <a-entity position="0 -0.5 -5" rotate-y="speed: 0.25">
        <a-cylinder height="0.12" radius="1.8" color="#222222" material="metalness:0.85; roughness:0.15"></a-cylinder>
        <a-torus radius="1.8" radius-tubular="0.045" color="#4466ff"
          material="emissive:#4466ff; emissiveIntensity:1; opacity:0.85; transparent:true"
          position="0 0.06 0" rotation="90 0 0">
        </a-torus>

        <!--
          CALCOLO VERIFICATO CON MATRICE:
          rotation="-90 90 0" (ordine XYZ) trasforma:
            GLB (bb_cx=-110, 0, z_min=-4.32) → world (0, -0.039, +0.99)
          
          Per mettere il CENTRO BB a (0,0,0) della piattaforma e le ruote sul disco:
            position X = 0
            position Y = +0.099  (porta fondo ruote a top disco)
            position Z = -0.99   ← era +0.99, SBAGLIATO!
          
          Con Z=-0.99 il centro BB del modello cade esattamente su X=0,Z=0
          della piattaforma → ruota su se stesso.
        -->
        <a-entity
          gltf-model="#auto"
          rotation="-90 90 0"
          scale="0.009 0.009 0.009"
          position="0 0.099 -0.99">
        </a-entity>
      </a-entity>

      <!-- ═══ CAMERA + CURSORE ════════════════════════════════════════════════ -->
      <a-entity camera look-controls="pointerLockEnabled: false" position="0 1.6 0">
        <a-cursor
          fuse="false"
          raycaster="objects: .gaze-target; far: 14"
          geometry="primitive: ring; radiusInner: 0.012; radiusOuter: 0.018"
          material="color: #ffffff; shader: flat; opacity: 0.7">
        </a-cursor>
      </a-entity>

      <!-- ═══ PANNELLI ════════════════════════════════════════════════════════ -->

      <!-- P1 — sinistra, BLU -->
      <a-entity position="-2.5 1.6 -1.5" rotation="0 60 0">
        <a-text value="TITOLO 1" align="center" color="#4488ff" width="2.4" position="0 0.52 0" wrap-count="18"></a-text>
        <a-box position="0 0.32 0" width="0.85" height="0.012" depth="0.005" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1.5"></a-box>
        <a-plane id="t1" class="gaze-target" width="1.9" height="1.2" position="0 0 0" material="opacity:0; transparent:true; side:double"></a-plane>
        <a-entity id="b1" gaze-body>
          <a-plane width="1.7" height="0.72" position="0 -0.12 -0.005" material="color:#05091f; opacity:0.93; transparent:true; side:double"></a-plane>
          <a-box position=" 0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1.3"></a-box>
          <a-box position="-0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1.3"></a-box>
          <a-box position="0  0.245 0" width="1.7" height="0.025" depth="0.008" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1.3"></a-box>
          <a-box position="0 -0.485 0" width="1.7" height="0.025" depth="0.008" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1.3"></a-box>
          <a-text value="Inserisci qui il tuo testo." align="center" color="#aabbff" width="1.5" position="0 -0.12 0.01" wrap-count="30"></a-text>
        </a-entity>
      </a-entity>

      <!-- P2 — destra, ARANCIO -->
      <a-entity position="2.5 1.6 -1.5" rotation="0 -60 0">
        <a-text value="TITOLO 2" align="center" color="#ff7722" width="2.4" position="0 0.52 0" wrap-count="18"></a-text>
        <a-box position="0 0.32 0" width="0.85" height="0.012" depth="0.005" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1.5"></a-box>
        <a-plane id="t2" class="gaze-target" width="1.9" height="1.2" position="0 0 0" material="opacity:0; transparent:true; side:double"></a-plane>
        <a-entity id="b2" gaze-body>
          <a-plane width="1.7" height="0.72" position="0 -0.12 -0.005" material="color:#1a0800; opacity:0.93; transparent:true; side:double"></a-plane>
          <a-box position=" 0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1.3"></a-box>
          <a-box position="-0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1.3"></a-box>
          <a-box position="0  0.245 0" width="1.7" height="0.025" depth="0.008" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1.3"></a-box>
          <a-box position="0 -0.485 0" width="1.7" height="0.025" depth="0.008" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1.3"></a-box>
          <a-text value="Inserisci qui il tuo testo." align="center" color="#ffddaa" width="1.5" position="0 -0.12 0.01" wrap-count="30"></a-text>
        </a-entity>
      </a-entity>

      <!-- P3 — dietro-sinistra, VERDE -->
      <a-entity position="-2.0 1.6 1.5" rotation="0 120 0">
        <a-text value="TITOLO 3" align="center" color="#00ffaa" width="2.4" position="0 0.52 0" wrap-count="18"></a-text>
        <a-box position="0 0.32 0" width="0.85" height="0.012" depth="0.005" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1.5"></a-box>
        <a-plane id="t3" class="gaze-target" width="1.9" height="1.2" position="0 0 0" material="opacity:0; transparent:true; side:double"></a-plane>
        <a-entity id="b3" gaze-body>
          <a-plane width="1.7" height="0.72" position="0 -0.12 -0.005" material="color:#001a0d; opacity:0.93; transparent:true; side:double"></a-plane>
          <a-box position=" 0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1.3"></a-box>
          <a-box position="-0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1.3"></a-box>
          <a-box position="0  0.245 0" width="1.7" height="0.025" depth="0.008" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1.3"></a-box>
          <a-box position="0 -0.485 0" width="1.7" height="0.025" depth="0.008" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1.3"></a-box>
          <a-text value="Inserisci qui il tuo testo." align="center" color="#ccffe8" width="1.5" position="0 -0.12 0.01" wrap-count="30"></a-text>
        </a-entity>
      </a-entity>

      <!-- P4 — dietro-destra, VIOLA -->
      <a-entity position="2.0 1.6 1.5" rotation="0 -120 0">
        <a-text value="TITOLO 4" align="center" color="#cc44ff" width="2.4" position="0 0.52 0" wrap-count="18"></a-text>
        <a-box position="0 0.32 0" width="0.85" height="0.012" depth="0.005" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1.5"></a-box>
        <a-plane id="t4" class="gaze-target" width="1.9" height="1.2" position="0 0 0" material="opacity:0; transparent:true; side:double"></a-plane>
        <a-entity id="b4" gaze-body>
          <a-plane width="1.7" height="0.72" position="0 -0.12 -0.005" material="color:#0d0020; opacity:0.93; transparent:true; side:double"></a-plane>
          <a-box position=" 0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1.3"></a-box>
          <a-box position="-0.84 -0.12 0" width="0.025" height="0.72" depth="0.008" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1.3"></a-box>
          <a-box position="0  0.245 0" width="1.7" height="0.025" depth="0.008" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1.3"></a-box>
          <a-box position="0 -0.485 0" width="1.7" height="0.025" depth="0.008" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1.3"></a-box>
          <a-text value="Inserisci qui il tuo testo." align="center" color="#eeccff" width="1.5" position="0 -0.12 0.01" wrap-count="30"></a-text>
        </a-entity>
      </a-entity>

      <script>
        window.addEventListener('load', () => {
          [['t1','b1'],['t2','b2'],['t3','b3'],['t4','b4']].forEach(([tid, bid]) => {
            const tr = document.getElementById(tid);
            const bd = document.getElementById(bid);
            tr.addEventListener('mouseenter', () => { if(bd.components['gaze-body']) bd.components['gaze-body']._t = 1; });
            tr.addEventListener('mouseleave', () => { if(bd.components['gaze-body']) bd.components['gaze-body']._t = 0; });
          });
        });
      </script>

    </a-scene>
  </body>
</html>
