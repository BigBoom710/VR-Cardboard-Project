<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Car Showcase VR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>

    // ─── Piattaforma rotante ─────────────────────────────────────────────────
    AFRAME.registerComponent('rotate-platform', {
      schema: { speed: { type: 'number', default: 0.3 } },
      tick: function (time, delta) {
        this.el.object3D.rotation.y += THREE.MathUtils.degToRad(this.data.speed) * (delta / 1000) * 60;
      }
    });

    // ─── Gaze hover: appare quando guardi, scompare quando non guardi ────────
    AFRAME.registerComponent('gaze-panel', {
      schema: {
        fadeDuration: { type: 'number', default: 300 }
      },
      init: function () {
        this._visible = false;
        this._opacity = 0;
        this._target  = 0;

        // Imposta opacità iniziale a 0
        this._setOpacity(0);

        this.el.addEventListener('mouseenter', () => { this._target = 1; });
        this.el.addEventListener('mouseleave', () => { this._target = 0; });
      },

      tick: function (time, delta) {
        if (this._opacity === this._target) return;
        const step = (delta / this.data.fadeDuration);
        if (this._target === 1) {
          this._opacity = Math.min(1, this._opacity + step);
        } else {
          this._opacity = Math.max(0, this._opacity - step);
        }
        this._setOpacity(this._opacity);
      },

      _setOpacity: function (val) {
        this._opacity = val;
        // aggiorna tutti i figli (background + testo)
        this.el.object3D.traverse(obj => {
          if (obj.material) {
            obj.material.opacity = val;
            obj.material.transparent = true;
          }
        });
      }
    });

    </script>
  </head>

  <body>
    <a-scene
      background="color: #0d0d0d"
      vr-mode-ui="enabled: true"
      renderer="antialias: true; colorManagement: true; shadowMapEnabled: true"
    >

      <!-- ═══ ASSETS ═══════════════════════════════════════════════════════════ -->
      <a-assets>
        <a-asset-item id="auto" src="macchina_test.glb"></a-asset-item>
      </a-assets>

      <!-- ═══ LUCI ══════════════════════════════════════════════════════════════ -->
      <a-light type="ambient" color="#1a1a2e" intensity="0.8"></a-light>

      <!-- Spotlight principale dall'alto sulla macchina -->
      <a-light type="spot"
        position="0 6 -4"
        target="#car-platform"
        color="#ffffff"
        intensity="2.5"
        angle="35"
        penumbra="0.4"
        cast-shadow="true">
      </a-light>

      <!-- Luci laterali colorate stile garage showroom -->
      <a-light type="point" position="-5 3 -4" color="#4466ff" intensity="1.5" distance="8"></a-light>
      <a-light type="point" position=" 5 3 -4" color="#ff6600" intensity="0.8" distance="8"></a-light>
      <a-light type="point" position="0 0.2 -1" color="#ffffff" intensity="0.6" distance="4"></a-light>

      <!-- Luce di riempimento dal basso (rim light) -->
      <a-light type="point" position="0 -0.5 -4" color="#223366" intensity="1" distance="5"></a-light>

      <!-- ═══ GARAGE ENVIRONMENT ════════════════════════════════════════════════ -->

      <!-- Pavimento cemento scuro -->
      <a-plane
        position="0 -0.51 -4"
        rotation="-90 0 0"
        width="20" height="20"
        color="#1a1a1a"
        material="metalness: 0.3; roughness: 0.8"
        receive-shadow="true">
      </a-plane>

      <!-- Linee pavimento stile officina -->
      <a-box position=" 1.5 -0.505 -4" width="0.05" height="0.001" depth="20" color="#ffcc00" material="emissive: #ffcc00; emissiveIntensity: 0.3"></a-box>
      <a-box position="-1.5 -0.505 -4" width="0.05" height="0.001" depth="20" color="#ffcc00" material="emissive: #ffcc00; emissiveIntensity: 0.3"></a-box>

      <!-- Pareti -->
      <a-plane position="0 4 -12"  rotation="0 0 0"   width="24" height="10" color="#111111" material="roughness:1"></a-plane>
      <a-plane position="-10 4 -4" rotation="0 90 0"  width="20" height="10" color="#111111" material="roughness:1"></a-plane>
      <a-plane position=" 10 4 -4" rotation="0 -90 0" width="20" height="10" color="#111111" material="roughness:1"></a-plane>
      <!-- Soffitto -->
      <a-plane position="0 8 -4" rotation="90 0 0" width="24" height="20" color="#0d0d0d" material="roughness:1"></a-plane>

      <!-- Strisce LED sul soffitto -->
      <a-box position="-2 7.9 -4" width="0.08" height="0.08" depth="16" color="#ffffff" material="emissive: #ffffff; emissiveIntensity: 1; opacity: 0.9; transparent:true"></a-box>
      <a-box position=" 2 7.9 -4" width="0.08" height="0.08" depth="16" color="#ffffff" material="emissive: #ffffff; emissiveIntensity: 1; opacity: 0.9; transparent:true"></a-box>

      <!-- Strisce LED a parete bassa (accent blu) -->
      <a-box position="-9.9 0.1 -4" width="0.05" height="0.05" depth="20" color="#4466ff" material="emissive: #4466ff; emissiveIntensity: 1; opacity: 0.6; transparent:true"></a-box>
      <a-box position=" 9.9 0.1 -4" width="0.05" height="0.05" depth="20" color="#4466ff" material="emissive: #4466ff; emissiveIntensity: 1; opacity: 0.6; transparent:true"></a-box>

      <!-- ═══ PIATTAFORMA ROTANTE ═══════════════════════════════════════════════ -->
      <a-entity id="car-platform" position="0 -0.5 -5">

        <!-- Disco piattaforma -->
        <a-cylinder
          height="0.12"
          radius="1.8"
          color="#222222"
          material="metalness: 0.8; roughness: 0.2"
          position="0 0 0">
        </a-cylinder>
        <!-- Bordo luminoso piattaforma -->
        <a-torus
          radius="1.8"
          radius-tubular="0.04"
          color="#4466ff"
          material="emissive: #4466ff; emissiveIntensity: 1; opacity: 0.8; transparent: true"
          position="0 0.06 0"
          rotation="90 0 0">
        </a-torus>

        <!-- Macchina: ruote di lato → rotation="0 90 0" per ruotarla di 90° sull'asse Y -->
        <a-entity
          gltf-model="#auto"
          position="0 0.1 0"
          rotation="0 90 0"
          scale="0.05 0.05 0.05"
          rotate-platform="speed: 0.25">
        </a-entity>

      </a-entity>

      <!-- ═══ PANNELLI INFORMATIVI (gaze-activated) ════════════════════════════
           Posizionati attorno all'utente (che sta in 0,1.6,0)
           a distanza ~3m, altezza occhi
      ══════════════════════════════════════════════════════════════════════════ -->

      <!-- Cursore per il gaze (obbligatorio per mouseenter/mouseleave) -->
      <a-entity camera look-controls="pointerLockEnabled: false" position="0 1.6 0">
        <a-cursor
          color="#ffffff"
          opacity="0.7"
          raycaster="objects: .info-panel"
          fuse="false">
        </a-cursor>
      </a-entity>

      <!-- PANNELLO 1 — davanti a sinistra -->
      <a-entity
        class="info-panel"
        gaze-panel
        position="-2.8 1.6 -3.5"
        rotation="0 30 0"
        look-at="[camera]"
      >
        <!-- Sfondo pannello -->
        <a-plane
          width="1.4" height="0.9"
          color="#0a0a1a"
          material="opacity: 0; transparent: true; side: double"
          border="color: #4466ff"
        ></a-plane>
        <!-- Cornice luminosa -->
        <a-entity position="0 0 0.001">
          <a-box position=" 0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="-0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0  0.435 0" width="1.4" height="0.03" depth="0.01" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0 -0.435 0" width="1.4" height="0.03" depth="0.01" color="#4466ff" material="emissive:#4466ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
        </a-entity>
        <!-- Testo titolo -->
        <a-text
          value="TITOLO PANNELLO 1"
          align="center"
          color="#4488ff"
          width="1.2"
          position="0 0.3 0.002"
          font="exo2bold"
          wrap-count="20">
        </a-text>
        <!-- Testo corpo -->
        <a-text
          value="Testo da compilare."
          align="center"
          color="#ccddff"
          width="1.1"
          position="0 -0.05 0.002"
          wrap-count="28">
        </a-text>
      </a-entity>

      <!-- PANNELLO 2 — davanti a destra -->
      <a-entity
        class="info-panel"
        gaze-panel
        position="2.8 1.6 -3.5"
        rotation="0 -30 0"
      >
        <a-plane width="1.4" height="0.9" color="#0a0a1a" material="opacity: 0; transparent: true; side: double"></a-plane>
        <a-entity position="0 0 0.001">
          <a-box position=" 0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="-0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0  0.435 0" width="1.4" height="0.03" depth="0.01" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0 -0.435 0" width="1.4" height="0.03" depth="0.01" color="#ff6600" material="emissive:#ff6600; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
        </a-entity>
        <a-text value="TITOLO PANNELLO 2" align="center" color="#ff8833" width="1.2" position="0 0.3 0.002" font="exo2bold" wrap-count="20"></a-text>
        <a-text value="Testo da compilare." align="center" color="#ffddcc" width="1.1" position="0 -0.05 0.002" wrap-count="28"></a-text>
      </a-entity>

      <!-- PANNELLO 3 — laterale sinistra -->
      <a-entity
        class="info-panel"
        gaze-panel
        position="-3.5 1.6 -5"
        rotation="0 70 0"
      >
        <a-plane width="1.4" height="0.9" color="#0a0a1a" material="opacity: 0; transparent: true; side: double"></a-plane>
        <a-entity position="0 0 0.001">
          <a-box position=" 0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="-0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0  0.435 0" width="1.4" height="0.03" depth="0.01" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0 -0.435 0" width="1.4" height="0.03" depth="0.01" color="#00ffaa" material="emissive:#00ffaa; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
        </a-entity>
        <a-text value="TITOLO PANNELLO 3" align="center" color="#00ffaa" width="1.2" position="0 0.3 0.002" font="exo2bold" wrap-count="20"></a-text>
        <a-text value="Testo da compilare." align="center" color="#ccffe8" width="1.1" position="0 -0.05 0.002" wrap-count="28"></a-text>
      </a-entity>

      <!-- PANNELLO 4 — dietro/laterale destra -->
      <a-entity
        class="info-panel"
        gaze-panel
        position="3.5 1.6 -5"
        rotation="0 -70 0"
      >
        <a-plane width="1.4" height="0.9" color="#0a0a1a" material="opacity: 0; transparent: true; side: double"></a-plane>
        <a-entity position="0 0 0.001">
          <a-box position=" 0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="-0.69 0 0" width="0.03" height="0.9"  depth="0.01" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0  0.435 0" width="1.4" height="0.03" depth="0.01" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
          <a-box position="0 -0.435 0" width="1.4" height="0.03" depth="0.01" color="#cc44ff" material="emissive:#cc44ff; emissiveIntensity:1; opacity:0; transparent:true"></a-box>
        </a-entity>
        <a-text value="TITOLO PANNELLO 4" align="center" color="#cc44ff" width="1.2" position="0 0.3 0.002" font="exo2bold" wrap-count="20"></a-text>
        <a-text value="Testo da compilare." align="center" color="#eeccff" width="1.1" position="0 -0.05 0.002" wrap-count="28"></a-text>
      </a-entity>

    </a-scene>
  </body>
</html>
